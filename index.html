<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ежедневный отчет</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --secondary-bg: #f2f2f7;
            --button-color: #3390ec;
            --button-text: #ffffff;
        }

        /* Адаптация под темную тему Телеграм */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1c1c1e;
                --text-color: #ffffff;
                --secondary-bg: #2c2c2e;
                --button-color: #3390ec;
                --button-text: #ffffff;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.8;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: none;
            background-color: var(--secondary-bg);
            color: var(--text-color);
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
            /* Убираем стили iOS */
            -webkit-appearance: none; 
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Особый стиль для кнопки (имитация MainButton телеграма, если нужно, или просто красивая кнопка) */
        .submit-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--button-color);
            color: var(--button-text);
            border: none;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-top: 10px;
        }

        .submit-btn:active {
            opacity: 0.8;
        }

        .hidden {
            display: none;
        }

        #loading, #success-screen {
            text-align: center;
            padding-top: 50px;
        }
        
        /* Анимация галочки */
        .checkmark {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #fff;
            stroke-miterlimit: 10;
            margin: 10% auto;
            box-shadow: inset 0px 0px 0px #7ac142;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #7ac142;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 30px #7ac142; } }

    </style>
</head>
<body>

<div id="app">
    <h2>Ежедневный отчет</h2>
    <form id="reportForm">
        
        <div class="form-group">
            <label for="calls">Количество звонков</label>
            <input type="number" id="calls" inputmode="numeric" placeholder="0" required>
        </div>

        <div class="form-group">
            <label for="sales">Количество продаж</label>
            <input type="number" id="sales" inputmode="numeric" placeholder="0" required>
        </div>

        <div class="form-group">
            <label for="income">Сумма выручки (₽)</label>
            <input type="number" id="income" inputmode="numeric" placeholder="0" required>
        </div>

        <div class="form-group">
            <label for="comment">Комментарий (планы/проблемы)</label>
            <textarea id="comment" placeholder="Напишите комментарий..."></textarea>
        </div>

        <button type="button" class="submit-btn" onclick="submitForm()">Отправить отчет</button>
    </form>
</div>

<div id="loading" class="hidden">
    <p>Отправка данных...</p>
</div>

<div id="success-screen" class="hidden">
    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
        <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
    </svg>
    <h3>Готово!</h3>
    <p>Отчет успешно отправлен.</p>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // Развернуть на весь экран

    // --- ВСТАВЬТЕ СЮДА ВАШУ ССЫЛКУ ИЗ GOOGLE APPS SCRIPT ---
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyU4SfLkxavKyPQBGNQ3xWFGUnYGZBr7vXYC1jZYVDqbSMUvRzmvTAndaserZvQQ8X9/exec'; 
    // -------------------------------------------------------

    function submitForm() {
        const calls = document.getElementById('calls').value;
        const sales = document.getElementById('sales').value;
        const income = document.getElementById('income').value;
        const comment = document.getElementById('comment').value;

        if(!calls || !sales || !income) {
            tg.showPopup({
                title: 'Ошибка',
                message: 'Заполните все числовые поля',
                buttons: [{type: 'ok'}]
            });
            return;
        }

        // Данные пользователя
        const user = tg.initDataUnsafe.user || { first_name: 'Unknown', username: 'anon' };
        
        // --- ИЗМЕНЕНИЕ ЗДЕСЬ: ЖЕСТКАЯ ПРИВЯЗКА К ID ЧАТА ---
        const chatId = '-1003850354146'; 
        // --------------------------------------------------

        // Показать экран загрузки
        document.getElementById('app').style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        const data = {
            chat_id: chatId,
            user_name: user.first_name + (user.last_name ? ' ' + user.last_name : ''),
            username: user.username ? '@' + user.username : 'Нет юзернейма',
            calls: calls,
            sales: sales,
            income: income,
            comment: comment
        };

        // Отправка (POST запрос)
        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Важно для Google Script
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(() => {
            // Успех
            document.getElementById('loading').style.display = 'none';
            document.getElementById('success-screen').style.display = 'block';
            if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            
            // Закрыть приложение через 3 секунды (по желанию - можно убрать)
            setTimeout(() => {
                tg.close();
            }, 3000);

        }).catch(err => {
            alert("Ошибка: " + err);
            document.getElementById('app').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        });
    }
</script>

</body>
</html>
